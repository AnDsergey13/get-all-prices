# Binance Data Downloader & Analyzer

Программа для загрузки и анализа минутных данных о ценах криптовалютных пар с биржи Binance.

## Описание

Этот проект состоит из двух основных скриптов:
- `main.py` - загрузка исторических данных о ценах с Binance API
- `analys.py` - анализ загруженных данных, расчет процентных изменений и частотный анализ

Программа автоматически определяет реальную дату начала торгов для любой валютной пары на Binance, что позволяет получать данные начиная с момента листинга пары на бирже.

## Особенности

- ✅ Автоматическое определение даты начала торгов для любой пары
- ✅ Загрузка минутных свечей (OHLCV) с Binance API
- ✅ Расчет процентных изменений цен между соседними минутами
- ✅ Частотный анализ изменений цен
- ✅ Гибкая работа с разными валютными парами через аргументы командной строки
- ✅ Автоматическое сохранение прогресса загрузки
- ✅ Поддержка возобновления загрузки после прерывания
- ✅ Подробное логирование процесса

## Требования

- Python 3.7+
- Библиотеки: `requests`, `argparse`

## Установка

1. Клонируйте репозиторий:
```bash
git clone <URL-репозитория>
cd <имя-папки>
```

2. Установите необходимые зависимости:
```bash
pip install requests
```

## Использование

### 1. Загрузка данных

Для загрузки данных о ценах используйте скрипт `main.py`:

```bash
# Базовый синтаксис
python main.py --symbol СИМВОЛ

# Пример для ZROUSDT
python main.py --symbol ZROUSDT

# Пример для BTCUSDT
python main.py --symbol BTCUSDT

# С указанием начальной даты (если хотите ограничить период)
python main.py --symbol ETHUSDT --start_date "2023-01-01 00:00:00"
```

**Параметры:**
- `--symbol` - торговая пара (например, ZROUSDT, BTCUSDT, ETHUSDT)
- `--start_date` - начальная дата загрузки в формате "YYYY-MM-DD HH:MM:SS" (опционально)

**Результат выполнения:**
- Создается файл `{символ}_minute_prices.json` с минутными данными о ценах
- В консоли отображается прогресс загрузки
- Логи сохраняются в файл `data_download.log`

### 2. Анализ данных

Для анализа загруженных данных используйте скрипт `analys.py`:

```bash
# Базовый синтаксис
python analys.py --symbol СИМВОЛ

# Пример для ZROUSDT
python analys.py --symbol ZROUSDT

# Пример для BTCUSDT
python analys.py --symbol BTCUSDT
```

**Результат выполнения:**
- `price_changes_{символ}.json` - файл с процентными изменениями цен
- `frequency_analysis_full_{символ}.json` - полный частотный анализ
- `frequency_analysis_report_{символ}.txt` - текстовый отчет с анализом

## Пример полного рабочего процесса

```bash
# 1. Загрузка данных для ZROUSDT
python main.py --symbol ZROUSDT

# 2. Анализ загруженных данных
python analys.py --symbol ZROUSDT

# 3. Загрузка данных для другой пары
python main.py --symbol BTCUSDT

# 4. Анализ данных для BTCUSDT
python analys.py --symbol BTCUSDT
```

## Структура проекта

```
├── main.py                 # Скрипт загрузки данных
├── analys.py              # Скрипт анализа данных
├── data_download.log      # Логи загрузки
├── README.md              # Документация (этот файл)
├── *_minute_prices.json   # Файлы с минутными данными
├── price_changes_*.json   # Файлы с процентными изменениями
├── frequency_analysis_full_*.json  # Полный частотный анализ
└── frequency_analysis_report_*.txt # Текстовые отчеты
```

## Описание файлов данных

### 1. Минутные данные ({символ}_minute_prices.json)
Формат: массив массивов `[timestamp, close_price]`
```json
[
  [1509915600000, "0.1234"],
  [1509915660000, "0.1235"],
  ...
]
```
- `timestamp` - время открытия свечи в миллисекундах
- `close_price` - цена закрытия свечи

### 2. Процентные изменения (price_changes_{символ}.json)
Формат: массив массивов `[timestamp, percentage_change]`
```json
[
  [1509915660000, 0.0813008130],
  [1509915720000, -0.1620718615],
  ...
]
```
- `timestamp` - время изменения
- `percentage_change` - процентное изменение цены (округлено до 10 знаков)

### 3. Частотный анализ (frequency_analysis_full_{символ}.json)
Формат: массив массивов `[percentage_change, count]`
```json
[
  [0.0, 12345],
  [0.1, 5678],
  [-0.1, 4321],
  ...
]
```
- `percentage_change` - значение процентного изменения
- `count` - количество раз, которое встретилось это изменение

### 4. Текстовый отчет (frequency_analysis_report_{символ}.txt)
Содержит:
- Топ-50 самых частых изменений
- Топ-50 самых редких изменений
- 10 самых больших положительных изменений
- 10 самых больших отрицательных изменений
- Общую статистику

## Как работает автоматическое определение даты начала торгов

Программа использует особенность Binance API: при запросе данных с временной меткой раньше даты листинга пары, API автоматически возвращает данные, начиная с реальной даты начала торгов.

Алгоритм:
1. Запрашивается первая минутная свеча с очень ранней даты (2010 год)
2. Binance API возвращает первую свечу, доступную для этой пары
3. Полученная временная метка используется как дата начала загрузки

Это гарантирует, что вы получите все доступные данные для любой валютной пары, не зная заранее дату ее листинга.

## Обработка ошибок

Программа включает механизмы обработки различных ситуаций:
- **Ограничения API Binance**: автоматическое ожидание при превышении лимитов
- **Сетевые ошибки**: повторные попытки с экспоненциальной задержкой
- **Отсутствие данных**: переход к следующему временному интервалу
- **Прерывание загрузки**: сохранение прогресса и возможность возобновления

## Логирование

Все действия программы логируются:
- Консольный вывод для отслеживания прогресса
- Файл `data_download.log` с подробными логами
- Уровни логирования: INFO, WARNING, ERROR, DEBUG

## Пример вывода программы

### При загрузке данных:
```
2024-01-01 12:00:00,000 - INFO - Starting ZROUSDT minute data download
2024-01-01 12:00:00,001 - INFO - Getting first trading date for ZROUSDT
2024-01-01 12:00:00,500 - INFO - First trading date for ZROUSDT: 2023-07-17 10:00:00
2024-01-01 12:00:00,501 - INFO - Using start date: 2023-07-17 10:00:00
2024-01-01 12:00:01,000 - INFO - Successful request: 1689592800000 to 1689599199999
2024-01-01 12:00:01,500 - INFO - Progress: 50000 records | From 2023-07-17 10:00:00 to 2023-08-01 15:00:00
...
```

### При анализе данных:
```
Загружено 123456 записей
Обработано 100000/123455 записей (81.0%) | Текущая дата: 2023-08-01 15:00

Процентные изменения сохранены в price_changes_zrousdt.json

Самые частые изменения (топ-50):
      0.0000000000% |      45,678
      0.1000000000% |      12,345
     -0.1000000000% |      11,234
...
Полный отчет сохранен в frequency_analysis_report_zrousdt.txt
```

## Ограничения

- Максимальное количество свечей в одном запросе: 1000
- Задержка между запросами: 0.2 секунды (для соблюдения лимитов API)
- Программа работает только с минутными таймфреймами

---

**Примечание:** Программа использует публичное API Binance и не требует API ключей для загрузки исторических данных.