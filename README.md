# Binance Data Downloader & Analyzer

Программа для загрузки и анализа данных о ценах криптовалютных пар с биржи Binance с поддержкой различных таймфреймов.

❗️ Реализовано с помощью модели `GLM-4.5`

## Описание

Этот проект состоит из двух основных скриптов:
- `main.py` - загрузка исторических данных о ценах с Binance API
- `analys.py` - анализ загруженных данных, расчет процентных изменений и частотный анализ

Программа автоматически определяет реальную дату начала торгов для любой валютной пары на Binance и поддерживает работу с различными таймфреймами свечей.

## Особенности

- ✅ Автоматическое определение даты начала торгов для любой пары
- ✅ Поддержка всех доступных таймфреймов Binance
- ✅ Загрузка свечей (OHLCV) с Binance API
- ✅ Расчет процентных изменений цен между соседними свечами
- ✅ Частотный анализ изменений цен
- ✅ Гибкая работа с разными валютными парами через аргументы командной строки
- ✅ Автоматическое сохранение прогресса загрузки
- ✅ Поддержка возобновления загрузки после прерывания
- ✅ Подробное логирование процесса

## Требования

- Python 3.7+
- UV (Python package manager)
- Библиотеки: `requests`, `argparse`

## Установка

1. Клонируйте репозиторий:
```bash
git clone <URL-репозитория>
cd <имя-папки>
```

2. Установите UV (если еще не установлен):
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

3. Установите необходимые зависимости:
```bash
uv sync
```

## Использование

### 1. Загрузка данных

Для загрузки данных о ценах используйте скрипт `main.py`:

```bash
# Базовый синтаксис
uv run main.py --symbol СИМВОЛ --interval ТАЙМФРЕЙМ

# Пример для ZROUSDT с минутными свечами
uv run main.py --symbol ZROUSDT --interval 1m

# Пример для BTCUSDT с часовыми свечами
uv run main.py --symbol BTCUSDT --interval 1h

# Пример для ETHUSDT с дневными свечами
uv run main.py --symbol ETHUSDT --interval 1d

# С указанием начальной даты
uv run main.py --symbol ETHUSDT --interval 4h --start_date "2023-01-01 00:00:00"
```

**Параметры:**
- `--symbol` - торговая пара (например, ZROUSDT, BTCUSDT, ETHUSDT)
- `--interval` - таймфрейм свечей (1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M)
- `--start_date` - начальная дата загрузки в формате "YYYY-MM-DD HH:MM:SS" (опционально)

**Результат выполнения:**
- Создается файл `{символ}_{интервал}_prices.json` с данными о ценах
- В консоли отображается прогресс загрузки
- Логи сохраняются в файл `data_download.log`

### 2. Анализ данных

Для анализа загруженных данных используйте скрипт `analys.py`:

```bash
# Базовый синтаксис
uv run analys.py --symbol СИМВОЛ --interval ТАЙМФРЕЙМ

# Пример для ZROUSDT с минутными свечами
uv run analys.py --symbol ZROUSDT --interval 1m

# Пример для BTCUSDT с часовыми свечами
uv run analys.py --symbol BTCUSDT --interval 1h
```

**Результат выполнения:**
- `price_changes_{символ}_{интервал}.json` - файл с процентными изменениями цен
- `frequency_analysis_full_{символ}_{интервал}.json` - полный частотный анализ
- `frequency_analysis_report_{символ}_{интервал}.txt` - текстовый отчет с анализом

## Доступные таймфреймы

| Интервал | Описание |
|---------|----------|
| 1m | 1 минута |
| 3m | 3 минуты |
| 5m | 5 минут |
| 15m | 15 минут |
| 30m | 30 минут |
| 1h | 1 час |
| 2h | 2 часа |
| 4h | 4 часа |
| 6h | 6 часов |
| 8h | 8 часов |
| 12h | 12 часов |
| 1d | 1 день |
| 3d | 3 дня |
| 1w | 1 неделя |
| 1M | 1 месяц |

## Пример полного рабочего процесса

```bash
# 1. Загрузка минутных данных для ZROUSDT
uv run main.py --symbol ZROUSDT --interval 1m

# 2. Анализ минутных данных
uv run analys.py --symbol ZROUSDT --interval 1m

# 3. Загрузка часовых данных для BTCUSDT
uv run main.py --symbol BTCUSDT --interval 1h

# 4. Анализ часовых данных
uv run analys.py --symbol BTCUSDT --interval 1h

# 5. Загрузка дневных данных для ETHUSDT
uv run main.py --symbol ETHUSDT --interval 1d

# 6. Анализ дневных данных
uv run analys.py --symbol ETHUSDT --interval 1d
```

## Структура проекта

```
├── main.py                 # Скрипт загрузки данных
├── analys.py              # Скрипт анализа данных
├── data_download.log      # Логи загрузки
├── README.md              # Документация (этот файл)
├── *_1m_prices.json       # Файлы с минутными данными
├── *_1h_prices.json       # Файлы с часовыми данными
├── *_1d_prices.json       # Файлы с дневными данными
├── price_changes_*_*.json # Файлы с процентными изменениями
├── frequency_analysis_full_*_*.json  # Полный частотный анализ
└── frequency_analysis_report_*_*.txt # Текстовые отчеты
```

## Описание файлов данных

### 1. Данные о ценах ({символ}_{интервал}_prices.json)
Формат: массив массивов `[timestamp, close_price]`
```json
[
  [1509915600000, "0.1234"],
  [1509915660000, "0.1235"],
  ...
]
```
- `timestamp` - время открытия свечи в миллисекундах
- `close_price` - цена закрытия свечи

### 2. Процентные изменения (price_changes_{символ}_{интервал}.json)
Формат: массив массивов `[timestamp, percentage_change]`
```json
[
  [1509915660000, 0.0813008130],
  [1509915720000, -0.1620718615],
  ...
]
```
- `timestamp` - время изменения
- `percentage_change` - процентное изменение цены (округлено до 10 знаков)

### 3. Частотный анализ (frequency_analysis_full_{символ}_{интервал}.json)
Формат: массив массивов `[percentage_change, count]`
```json
[
  [0.0, 12345],
  [0.1, 5678],
  [-0.1, 4321],
  ...
]
```
- `percentage_change` - значение процентного изменения
- `count` - количество раз, которое встретилось это изменение

### 4. Текстовый отчет (frequency_analysis_report_{символ}_{интервал}.txt)
Содержит:
- Топ-50 самых частых изменений
- Топ-50 самых редких изменений
- 10 самых больших положительных изменений
- 10 самых больших отрицательных изменений
- Общую статистику

## Как работает автоматическое определение даты начала торгов

Программа использует особенность Binance API: при запросе данных с временной меткой раньше даты листинга пары, API автоматически возвращает данные, начиная с реальной даты начала торгов.

Алгоритм:
1. Запрашивается первая свеча с очень ранней даты (2010 год) для указанного таймфрейма
2. Binance API возвращает первую свечу, доступную для этой пары
3. Полученная временная метка используется как дата начала загрузки

Это гарантирует, что вы получите все доступные данные для любой валютной пары, не зная заранее дату ее листинга.

## Обработка ошибок

Программа включает механизмы обработки различных ситуаций:
- **Ограничения API Binance**: автоматическое ожидание при превышении лимитов
- **Сетевые ошибки**: повторные попытки с экспоненциальной задержкой
- **Отсутствие данных**: переход к следующему временному интервалу
- **Прерывание загрузки**: сохранение прогресса и возможность возобновления

## Логирование

Все действия программы логируются:
- Консольный вывод для отслеживания прогресса
- Файл `data_download.log` с подробными логами
- Уровни логирования: INFO, WARNING, ERROR, DEBUG

## Пример вывода программы

### При загрузке данных:
```
2024-01-01 12:00:00,000 - INFO - Starting ZROUSDT 1h data download
2024-01-01 12:00:00,001 - INFO - Getting first trading date for ZROUSDT with interval 1h
2024-01-01 12:00:00,500 - INFO - First trading date for ZROUSDT (1h): 2023-07-17 10:00:00
2024-01-01 12:00:00,501 - INFO - Using start date: 2023-07-17 10:00:00
2024-01-01 12:00:01,000 - INFO - Successful request: 1689592800000 to 1689979199999
2024-01-01 12:00:01,500 - INFO - Progress: 500 records | From 2023-07-17 10:00:00 to 2023-08-01 15:00:00
...
```

### При анализе данных:
```
Загружено 1234 записей
Обработано 1000/1233 записей (81.0%) | Текущая дата: 2023-08-01 15:00

Процентные изменения сохранены в price_changes_zrousdt_1h.json

Анализ для ZROUSDT (интервал: 1h)
    Процентное изменение     |   Количество   
----------------------------------------
Самые частые изменения (топ-50):
      0.0000000000% |         456
      0.1000000000% |         123
     -0.1000000000% |         112
...
Полный отчет сохранен в frequency_analysis_report_zrousdt_1h.txt
```

## Ограничения

- Максимальное количество свечей в одном запросе: 1000
- Задержка между запросами: 0.2 секунды (для соблюдения лимитов API)
- Программа работает только с указанными таймфреймами

---

**Примечание:** Программа использует публичное API Binance и не требует API ключей для загрузки исторических данных.